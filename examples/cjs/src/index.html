<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Focus-no-Jutsu demo</title>
    <link rel="icon" href="./assets/focus-no-jutsu.ico" />
    <meta name="description" content="A demo of Focus-no-Jutsu">
  </head>
  <body>
    <div id="app">
      <a href="https://github.com/wswmsword/focus-no-jutsu" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; left: 0; transform: scale(-1, 1);" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style></a>
      <header>
        <h1><code>Focus-no-Jutsu</code> 范例</h1>
      </header>

      <p>该范例页面使用 <code>Focus-no-Jutsu</code>（<code>no-Jutsu</code> 的发音为 /ˈnɔˌjutsu/）管理和控制焦点，是一个<a href="https://www.w3.org/WAI/ARIA/apg/practices/keyboard-interface/">键盘可访问的界面</a>，您可以任意选择鼠标和键盘访问该页面。</p>
      
      <p>网页程序里有很多需要管理和控制的场景，例如弹窗、菜单、选项卡、抽屉等等，在我们按下键盘的 <kbd>Tab</kbd> ，焦点进入某个场景，我们希望焦点被施加一个幻术，让焦点陷入一个循环，或者被卡在首尾元素之间的秘密空间，直到我们按下 <kbd>Esc</kbd> 或者点击“返回”，解开幻术。</p>

      <p>接下来我们将施展 <code>Focus-no-Jutsu</code>，完成和焦点有关的一系列任务！🥷</p>

      <!-- <hr />

      <button id="t1">第一</button>
      <ul tabindex="0" id="cover">
        <li><button id="l1">测试</button></li>
        <li><button>测试</button></li>
        <li><button>测试</button></li>
        <li><button>测试</button></li>
        <li><div tabindex="0">测试<div tabindex="0">asdf<div tabindex="0">asdf</div></div></li>
        <li><button id="l9">测试</button></li>
      </ul>
      <button>最后</button> -->

      <h2 id="h-hot" tabindex="-1">热身</h2>

      <p>这个简单的例子演示了 focus-no-jutsu 基本的用法。首先通过 <kbd>Tab</kbd> 访问 entryBtn，然后按下 <kbd>Enter</kbd>，firstTabbableNode 成为焦点，按住 <kbd>Tab</kbd>，焦点将在 firstTabbableNode 和 lastTabbableNode 之间循环，最后，当焦点落在 lastTabbableNode 时按下 <kbd>Enter</kbd>，或者在列表内的任意元素上按下 <kbd>Esc</kbd>，焦点回到 entryBtn。</p>

      <div>
        <button id="entryBtn">entryBtn</button>
        <span id="loop">
          <button id="firstTabbableNode">firstTabbableNode</button>
          <button>second</button>
          <button>third</button>
          <button id="lastTabbableNode">lastTabbableNode(exit)</button>
        </span>
        <button>other</button>
      </div>

      <pre>
<code>focusNoJutsu(["#firstTabbableNode", "#lastTabbableNode"], {
  entry: "#entryBtn",
  exit: "#lastTabbableNode",
  onEscape: true,
  delayToFocus: true,
});
</code>
      </pre>

      <h2 id="h-dialog" tabindex="-1">对话框</h2>

      <p>对话框通常是一个弹窗，当 <kbd>Tab</kbd> 访问到“打开”按钮，焦点聚焦按钮，<kbd>Enter</kbd>（或者 <kbd>Space</kbd> 和鼠标点击）触发“打开”之后，弹出对话框，焦点聚焦对话框的首个可聚焦元素，这时如果继续 <kbd>Tab</kbd>，焦点只能访问对话框内的元素，不能逃出对话框或者回到“打开”按钮，最后，我们按下 <kbd>Esc</kbd> 或者触发“返回”按钮，焦点回到“打开”按钮。</p>

      <button class="button" id="open" aria-haspopup="dialog" aria-expanded="false" aria-controls="dialog">打开一包糖</button>
      <div id="dialog_mask" class="closed_mask"></div>
      <div id="dialog" aria-modal="true" aria-labelledby="modal-title" class="dialog centre closedDialog" role="dialog" tabindex="-1">
        <h3 id="modal-title">吃一颗糖果</h3>
        <p>爱吃糖果的小可爱，你的糖果已送达，请注意查收。不需冷藏，无需加热，一颗提神醒脑，两颗永不疲劳，三颗长生不老～</p>
        <div class="ctrls">
          <button class="button cancel" id="firstFocusBtn">巧克力！克力！力！</button>
          <button class="button" id="confirm">吃吃吃</button>
        </div>
        <button id="close" aria-label="Close" type="button">
          <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.49999L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.49999L11.7816 4.03157Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
        </button>
      </div>

      <details>
        <summary id="dialog_code">查看源码。</summary>

        <pre>
<code>const dialog = document.getElementById("dialog");
const mask = document.getElementById("dialog_mask");
const entry = document.getElementById("open");

// 6～18 行为焦点管理的部分，管理了焦点的入口、出口，以及焦点在列表内移动的范围
focusNoJutsu(dialog, ["#firstFocusBtn", "#close"], { // L:6
  loop: false,
  entry: {
    node: entry,
    on: openDialog,
  },
  exit: {
    node: ["#close", "#firstFocusBtn", "#confirm"],
    on: closeDialog,
    type: ["click", "outlist"]
  },
  onEscape: true,
}); // L:18

// 下面的两个函数和焦点无关，和样式或其它逻辑有关，这些代码在实际开发中，可以和上面的焦点部分分开，或者可以像本例中，把这些代码集成到焦点管理中

/** 打开弹窗，设置打开样式，设置 ARIA */
function openDialog() {
  dialog.classList.add("openedDialog");
  dialog.classList.remove("closedDialog");
  mask.classList.remove("closed_mask");
  entry.ariaExpanded = true;
}

/** 关闭弹窗，设置关闭样式，设置 ARIA */
function closeDialog() {
  dialog.classList.remove("openedDialog");
  dialog.classList.add("closedDialog");
  mask.classList.add("closed_mask");
  entry.ariaExpanded = false;
}</code>
        </pre>
      </details>

      <h2 id="h-nav" tabindex="-1">导航栏</h2>

      <p>导航栏是很常见的组件，很多时候会出现在网站的顶部。导航栏上是图标、按钮、链接和一些像主题切换的功能，这些都是这个网站最重要的部分，导航栏提供了最快的访问路径。下面的导航栏包含一个“目录”按钮，当“目录”获得焦点，按下 <kbd>Enter</kbd>，焦点会进入目录面板，落到第一个元素上，通过 <kbd>Tab</kbd> 导航至目录面板最后一个元素，再次按下 <kbd>Tab</kbd>，焦点将退出目录面板，并落到“Focus-no-Jutsu”的链接上。当焦点在目录面板中，按下 <kbd>Esc</kbd> 或者点击空白区域，焦点将回到目录按钮。</p>

      <nav id="navigation">
        <ul class="nav_ul">
          <li class="nav_item">
            <button class="nav_btn" id="menu_btn" aria-expanded="false" aria-controls="menu" >
              <span >目录</span>
            </button>
            <ul class="menu" id="menu" tabindex="0">
              <li>
                <a class="menu_link" href="#h-hot" id="hot_anchor">
                  <div class="title">热身</div>
                  <div class="desc">热身可以减少运动损伤、提高身体肌肉体温、提高内脏器官的功能水平</div>
                </a>
              </li>
              <li>
                <a class="menu_link" href="#h-dialog">
                  <div class="title">对话框</div>
                  <div class="desc">开发对话框时，要注意的焦点之间的跳跃和传递，对话框很常见，但通常会存在可访问性的问题</div>
                </a>
              </li>
              <li>
                <a class="menu_link" href="#h-nav">
                  <div class="title">导航栏</div>
                  <div class="desc">导航栏总是在页面的顶部，然而最近出现了很多在界面左侧的导航栏</div>
                </a>
              </li>
              <li>
                <a class="menu_link" href="#h-tabs">
                  <div class="title">选项卡</div>
                  <div class="desc">切换选项卡，展示相应面板，切换自动切换和手动切换</div>
                </a>
              </li>
              <li>
                <a class="menu_link" href="#h-player" id="player_anchor">
                  <div class="title">播放列表</div>
                  <div class="desc">音乐平台 Spotify 的网页有很好的键盘体验，其中一个例子是播放列表</div>
                </a>
              </li>
            </ul>
          </li>
          <li class="nav_item">
            <a id="nav_link" class="nav_link" href="https://github.com/wswmsword/focus-no-jutsu" target="_blank">
              <span>Focus-no-Jutsu<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewBox="0 0 24 24" width="24px" class="link_mark"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></span>
            </a>
          </li>
          <li class="nav_item">
            <a class="nav_link" href="https://github.com/wswmsword/postcss-mobile-forever" target="_blank">
              <span>Mobile-Forever<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewBox="0 0 24 24" width="24px" class="link_mark"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></span>
            </a>
          </li>
        </ul>
      </nav>

      <details>
        <summary id="navigation_code">查看源码。</summary>
        <pre>
<code>const menuBtn = document.getElementById("menu_btn");
const menuBody = document.getElementById("menu");

// 5～28 行为焦点管理和控制的部分，包含了触发入口和出口时的行为——切换菜单状态，toggleMenu
focusNoJutsu(menuBody, ["#hot_anchor", "#player_anchor"], { // L:5
  onEscape: toggleMenu,
  entry: {
    node: menuBtn,
    on: toggleMenu,
    onExit: true,
  },
  exit: [{
    node: "#hot_anchor",
    type: "keydown",
    key: e => e.key === "Tab" && e.shiftKey,
    on: toggleMenu,
  }, {
    node: "#player_anchor",
    type: "keydown",
    key: e => e.key === "Tab" && !e.shiftKey,
    on: toggleMenu,
    target: "#nav_link",
  }, {
    type: "outlist",
    on: toggleMenu,
    target: ({ e }) => e?.relatedTarget?.id?.includes("h-") ? false : menuBtn,
  }],
}); // L:28

/** 切换菜单时的样式变化 */
function toggleMenu() {
  menuBtn.classList.toggle("opened");
  menuBody.classList.toggle("opened");
  menuBtn.ariaExpanded = menuBtn.classList.contains("opened") ? true : false;
}</code>
      </pre>
      </details>

      <h2 id="h-tabs" tabindex="-1">选项卡</h2>

      <p>选项卡包含一个选项卡列表和一个面板，切换选项卡的时候，改变选项卡面板的内容。<kbd>Tab</kbd> 首先访问选项卡列表，焦点落入选项卡列表，再次 <kbd>Tab</kbd> 焦点将离开选项卡。在选项卡列表里，使用 <kbd>Left Arrow</kbd> 和 <kbd>Right Arrow</kbd> 访问每一个选项卡，有的选项卡也支持使用 <kbd>Home</kbd> 和 <kbd>End</kbd> 聚焦第一个和最后一个选项卡。</p>

      <div id="tabs">
        <div id="tab_list" role="tablist" aria-labelledby="tablist">
          <button id="tab_1" role="tab" aria-selected="false" aria-controls="tabpanel_1" tabindex="0">
            <span>海棠</span>
          </button>
          <button id="tab_2" role="tab" aria-selected="true" aria-controls="tabpanel_2" tabindex="0">
            <span>梨花</span>
          </button>
          <button id="tab_3" role="tab" aria-selected="false" aria-controls="tabpanel_3" tabindex="0">
            <span>木绣球</span>
          </button>
          <button id="tab_4" role="tab" aria-selected="false" aria-controls="tabpanel_4" tabindex="0">
            <span>月见草</span>
          </button>
          <button id="tab_5" role="tab" aria-selected="false" aria-controls="tabpanel_5" tabindex="0">
            <span>桃花</span>
          </button>
        </div>
        <div id="tabpanel_1" role="tabpanel" aria-labelledby="tab_1" class="is-hidden begonia">
          <div class="colors" role="presentation">
            <span class="color_a"></span>
            <span class="color_b"></span>
            <span class="color_c"></span>
          </div>
        </div>
        <div id="tabpanel_2" role="tabpanel" aria-labelledby="tab_2" class="pear_blossom">
          <div class="colors" role="presentation">
            <span class="color_a"></span>
            <span class="color_b"></span>
            <span class="color_c"></span>
          </div>
        </div>
        <div id="tabpanel_3" role="tabpanel" aria-labelledby="tab_3" class="is-hidden hydrangea">
          <div class="colors" role="presentation">
            <span class="color_a"></span>
            <span class="color_b"></span>
            <span class="color_c"></span>
          </div>
        </div>
        <div id="tabpanel_4" role="tabpanel" aria-labelledby="tab_4" class="is-hidden evening_primrose">
          <div class="colors" role="presentation">
            <span class="color_a"></span>
            <span class="color_b"></span>
            <span class="color_c"></span>
          </div>
        </div>
        <div id="tabpanel_5" role="tabpanel" aria-labelledby="tab_5" class="is-hidden peach_blossom">
          <div class="colors" role="presentation">
            <span class="color_a"></span>
            <span class="color_b"></span>
            <span class="color_c"></span>
          </div>
        </div>
      </div>

      <details>
        <summary id="tags_code">查看源码。</summary>

        <pre>          
<code>const tabList = ["#tab_1", "#tab_2", "#tab_3", "#tab_4", "#tab_5"];

// 4～17 行为焦点管理的部分，管理了焦点的入口、出口，以及焦点在列表内的移动
focusNoJutsu("#tab_list", tabList, { // L:4
  next: e => e.key === "ArrowRight",
  prev: e => e.key === "ArrowLeft",
  exit: [{
    key: e => e.key === "Tab" && !e.shiftKey,
    target: "#tags_code",
  }, {
    key: e => e.key === "Tab" && e.shiftKey,
    target: "#navigation_code",
  }],
  initialActive: 1,
  removeListenersEachExit: false,
  onMove,
}); // L:17

// 下面的函数和焦点无关，和样式或其它逻辑有关，这些代码在实际开发中，可以和上面的焦点部分分开，或者可以像本例中，把这些代码集成到焦点管理中

/** 进行样式修改，当焦点移动时，本次聚焦添加样式，上一次聚焦移除样式，更新 ARIA */
function onMove({ prev, cur, prevI, curI }) {
  if (prevI === -1 || curI === -1) return;
  prev.setAttribute("aria-selected", "false");
  cur.setAttribute("aria-selected", "true");
  const prevPanel = document.getElementById("tabpanel_" + (prevI + 1));
  const curPanel = document.getElementById("tabpanel_" + (curI + 1));
  prevPanel.classList.add('is-hidden');
  curPanel.classList.remove('is-hidden');
}</code>
        </pre>
      </details>

      <h2 id="h-player" tabindex="-1">播放列表</h2>

      <p>这个“播放列表”是一个真实例子，是 Spotify 的专辑界面，Spotify 网页有很好的键盘体验。如果有一类元素组成了列表，这类元素的每一个内部又包含很多可聚焦的子元素，这时使用 <kbd>Tab</kbd> 从头到尾的访问体验是崩溃的，因为元素太多、花费时间太长了。</p>
      
      <p>Spotify 是这样做的。一首专辑有多首单曲，首先 <kbd>Tab</kbd> 会聚焦整个专辑列表，继续 <kbd>Tab</kbd>，焦点将退出整个专辑列表，聚焦专辑列表的后一个元素；如果正在播放专辑中的某一首歌曲，首先 <kbd>Tab</kbd> 会聚焦整个专辑列表，继续 <kbd>Tab</kbd>，焦点不会退出专辑，而是会聚焦歌曲；退出专辑之后，回过头如果想要播放某一首歌，只要让焦点回到专辑列表，然后通过 <kbd>Up Arrow</kbd> 和 <kbd>Down Arrow</kbd> 来选中；听到动听的歌曲，我们会把这首歌曲收藏起来，当焦点回到歌曲，按下 <kbd>Left Arrow</kbd> 或者 <kbd>Right Arrow</kbd> 找到“收藏”按钮，就能进行后续的操作了。</p>

      <div class="player">
        <div class="head">
          <img class="cover_img" src="./assets/cover.jpg" alt="NARUTO -ナルト- オリジナルサウンドトラック">
          <div class="infos">
            <span class="type">专辑</span>
            <h3 class="title">NARUTO -ナルト- オリジナルサウンドトラック</h3>
            <div class="details">
              <a id="artist" href="https://open.spotify.com/artist/78JmbZfna6DOfhSoxccZZw" target="_blank">Toshio Masuda</a>
              <span class="dot"></span>
              <a href="https://open.spotify.com/artist/1HNngbrg0LENVuq56iQo0m" target="_blank">MUSASHI PROJECT</a>
              <span class="dot"></span>
              <span>2003</span>
              <span class="dot"></span>
              <span>20 首歌曲, </span>
              <span class="time">39 分钟 54 秒</span>
            </div>
          </div>
        </div>
        <div class="ctrls&body">
          <div class="ctrls">
            <div class="mock_play" tabindex="0" aria-label="播放" role="button"></div>
            <div class="mock_like" tabindex="0" aria-label="加入音乐库" role="button"></div>
            <div class="moke_more" tabindex="0" aria-label="更多" role="button"></div>
          </div>
          <div class="body">
            <div id="grid_wrapper" role="grid" aria-colcount="4" aria-rowcount="8" tabindex="0">
              <div class="table_head" role="presentation">
                <div class="table_head_inner" role="row" aria-rowindex="1">
                  <div role="columnheader" aria-colindex="1">#</div>
                  <div role="columnheader" aria-colindex="2">标题</div>
                  <div role="columnheader" aria-colindex="3" class="listeners_head">播放量</div>
                  <div role="columnheader" aria-colindex="4" aria-label="时长" class="time">
                    <svg role="img" height="16" width="16" aria-hidden="true" viewBox="0 0 16 16" data-encore-id="icon" class="time"><path d="M8 1.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13zM0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8z"></path><path d="M8 3.25a.75.75 0 0 1 .75.75v3.25H11a.75.75 0 0 1 0 1.5H7.25V4A.75.75 0 0 1 8 3.25z"></path></svg>
                  </div>
                </div>
              </div>
              <div id="songs_wrapper" class="cells_wrapper" role="presentation">
                <div id="song_1" role="row" aria-rowindex="2" aria-selected="false" class="song" tabindex="0">
                  <div role="gridcell" aria-colindex="1">
                    <span class="song_idx">1</span>
                    <button id="s1_play" class="song_play">▶️</button>
                  </div>
                  <div role="gridcell" aria-colindex="2">
                    <div class="title">オレがナルトだってばよ!</div>
                    <a id="s1_a" href="https://open.spotify.com/artist/78JmbZfna6DOfhSoxccZZw">Toshio Masuda</a>
                  </div>
                  <div role="gridcell" aria-colindex="3" class="listeners_cell">730,051</div>
                  <div role="gridcell" aria-colindex="4" class="last">
                    <button id="s1_like" class="song_like" aria-label="添加到音乐库"></button>
                    <div>1:38</div>
                    <button id="s1_more" class="song_more" aria-label="查看更多"></button>
                  </div>
                </div>

                <div id="song_2" role="row" aria-rowindex="3" aria-selected="false" class="song" tabindex="0">
                  <div role="gridcell" aria-colindex="1">
                    <span class="song_idx">2</span>
                    <button id="s2_play" class="song_play">▶️</button>
                  </div>
                  <div role="gridcell" aria-colindex="2">
                    <div class="title">九尾の妖狐</div>
                    <a id="s2_a" href="https://open.spotify.com/artist/78JmbZfna6DOfhSoxccZZw">Toshio Masuda</a>
                  </div>
                  <div role="gridcell" aria-colindex="3" class="listeners_cell">234,541</div>
                  <div role="gridcell" aria-colindex="4" class="last">
                    <button id="s2_like" class="song_like" aria-label="添加到音乐库"></button>
                    <div>1:38</div>
                    <button id="s2_more" class="song_more" aria-label="查看更多"></button>
                  </div>
                </div>

                <div id="song_3" role="row" aria-rowindex="4" aria-selected="false" class="song" tabindex="0">
                  <div role="gridcell" aria-colindex="1">
                    <span class="song_idx">3</span>
                    <button id="s3_play" class="song_play">▶️</button>
                  </div>
                  <div role="gridcell" aria-colindex="2">
                    <div class="title">朝</div>
                    <a id="s3_a" href="https://open.spotify.com/artist/1HNngbrg0LENVuq56iQo0m">MUSASHI PROJECT</a>
                  </div>
                  <div role="gridcell" aria-colindex="3" class="listeners_cell">500,229</div>
                  <div role="gridcell" aria-colindex="4" class="last">
                    <button id="s3_like" class="song_like" aria-label="添加到音乐库"></button>
                    <div>1:35</div>
                    <button id="s3_more" class="song_more" aria-label="查看更多"></button>
                  </div>
                </div>

                <div id="song_4" role="row" aria-rowindex="5" aria-selected="false" class="song" tabindex="0">
                  <div role="gridcell" aria-colindex="1">
                    <span class="song_idx">4</span>
                    <button id="s4_play" class="song_play">▶️</button>
                  </div>
                  <div role="gridcell" aria-colindex="2">
                    <div class="title">ナルトの日常!</div>
                    <a id="s4_a" href="https://open.spotify.com/artist/78JmbZfna6DOfhSoxccZZw">Toshio Masuda</a>
                  </div>
                  <div role="gridcell" aria-colindex="3" class="listeners_cell">373,295</div>
                  <div role="gridcell" aria-colindex="4" class="last">
                    <button id="s4_like" class="song_like" aria-label="添加到音乐库"></button>
                    <div>2:20</div>
                    <button id="s4_more" class="song_more" aria-label="查看更多"></button>
                  </div>
                </div>

                <div id="song_5" role="row" aria-rowindex="6" aria-selected="false" class="song" tabindex="0">
                  <div role="gridcell" aria-colindex="1">
                    <span class="song_idx">5</span>
                    <button id="s5_play" class="song_play">▶️</button>
                  </div>
                  <div role="gridcell" aria-colindex="2">
                    <div class="title">緊張</div>
                    <a id="s5_a" href="https://open.spotify.com/artist/1HNngbrg0LENVuq56iQo0m">MUSASHI PROJECT</a>
                  </div>
                  <div role="gridcell" aria-colindex="3" class="listeners_cell">654,962</div>
                  <div role="gridcell" aria-colindex="4" class="last">
                    <button id="s5_like" class="song_like" aria-label="添加到音乐库"></button>
                    <div>1:46</div>
                    <button id="s5_more" class="song_more" aria-label="查看更多"></button>
                  </div>
                </div>

                <div id="song_6" role="row" aria-rowindex="7" aria-selected="false" class="song" tabindex="0">
                  <div role="gridcell" aria-colindex="1">
                    <span class="song_idx">6</span>
                    <button id="s6_play" class="song_play">▶️</button>
                  </div>
                  <div role="gridcell" aria-colindex="2">
                    <div class="title">沸き上がる闘志</div>
                    <a id="s6_a" href="https://open.spotify.com/artist/1HNngbrg0LENVuq56iQo0m">MUSASHI PROJECT</a>
                  </div>
                  <div role="gridcell" aria-colindex="3" class="listeners_cell">4,896,666</div>
                  <div role="gridcell" aria-colindex="4" class="last">
                    <button id="s6_like" class="song_like" aria-label="添加到音乐库"></button>
                    <div>1:36</div>
                    <button id="s6_more" class="song_more" aria-label="查看更多"></button>
                  </div>
                </div>

                <div id="song_7" role="row" aria-rowindex="8" aria-selected="false" class="song" tabindex="0">
                  <div role="gridcell" aria-colindex="1">
                    <span class="song_idx">...</span>
                    <button id="s7_play" class="song_play">▶️</button>
                  </div>
                  <div role="gridcell" aria-colindex="2">
                    <div class="title">...</div>
                    <a id="s7_a" href="https://open.spotify.com/artist/1HNngbrg0LENVuq56iQo0m">...</a>
                  </div>
                  <div role="gridcell" aria-colindex="3" class="listeners_cell">...</div>
                  <div role="gridcell" aria-colindex="4" class="last">
                    <button id="s7_like" class="song_like" aria-label="添加到音乐库"></button>
                    <div>...</div>
                    <button id="s7_more" class="song_more" aria-label="查看更多"></button>
                  </div>
                </div>
              </div>
            </div>
            <div class="other_infos">
              <div>2003年3月19日</div>
              <div class="copyright">℗ 2003 TV Tokyo, SME Visual Works Inc.</div>
            </div>
          </div>
        </div>
        <div class="footer">
          <div class="more">
            <a id="more_from" class="more_1" href="https://open.spotify.com/artist/78JmbZfna6DOfhSoxccZZw/discography" target="_blank">更多来自 Toshio Masuda 的内容</a>
            <a class="more_2" href="https://open.spotify.com/artist/78JmbZfna6DOfhSoxccZZw/discography" target="_blank">查看唱片目录</a>
          </div>
        </div>
      </div>

      <details>
        <summary>查看源码。</summary>
        <pre>
<code>const songs = ["#song_1", "#song_2", "#song_3", "#song_4", "#song_5", "#song_6", "#song_7"];
// 3～38 行为播放列表的焦点管理部分，管理了焦点的入口、出口，以及焦点在列表内的移动
const playerBagel = focusNoJutsu("#songs_wrapper", songs, { // L:3
  next: e => e.key === "ArrowDown",
  prev: e => e.key === "ArrowUp",
  exit: [{
    key: e => e.key === "Tab" && !e.shiftKey,
    target: "#more_from",
  }, {
    key: e => e.key === "Tab" && e.shiftKey,
    target: "#grid_wrapper",
  }, {
    type: "outlist",
    target: false,
  }],
  entry: {
    node: "#grid_wrapper",
    key: (e, active) => (
      (e.key === "Tab" && !e.shiftKey && active > -1) ||
      e.key === "ArrowDown" ||
      e.key === "ArrowUp"
    ) && e.target.id === "grid_wrapper",
    type: "keydown",
  },
  onMove: onMovePlayer,
  correctionTarget({ lastI, last }) {
    if (lastI === -1)
      return "#grid_wrapper";
    return last;
  },
  removeListenersEachExit: false,
});

playerBagel.addForward("grid", {
  node: "#grid_wrapper",
  key: (e, _, active) => (e.key === "Tab" && !e.shiftKey && active === -1),
  target: "#more_from",
}); // L:38

/** 一首歌曲最后的聚焦焦点的序号 */
let songLastActiveIdx = 0;
/** 管理第 curI + 1 首歌曲的焦点 */
function initSongBagel(curI, lastActive) {
  const idx = curI + 1;
  const list = [`#s${idx}_play`, `#s${idx}_a`, `#s${idx}_like`, `#s${idx}_more`];
  // 47～70 行为播放列表内每一首歌曲的焦点管理部分，管理了焦点的入口、出口，以及焦点在列表内的移动
  return focusNoJutsu(`#song_${idx}`, list, { // L: 47
    entry: [{
      node: `#song_${idx}`,
      type: "focus",
      target: ({ list }) => list[lastActive],
    }, {
      node: `#song_${idx}`,
      key: e => e.key === "ArrowRight" || e.key === "ArrowLeft",
      type: "keydown",
    }, {
      node: `#song_${idx}`,
      type: "click",
      target: false,
    }],
    next: e => e.key === "ArrowRight",
    prev: e => e.key === "ArrowLeft",
    exit: {
      type: "outlist",
      target: false,
    },
    initialActive: songLastActiveIdx,
    correctionTarget: false,
    addEntryListenersEachExit: false,
  }); // L:70
}

let lastSong = null;

/** 焦点在播放列表内移动时的样式变化 */
function onMovePlayer({ cur, prev, curI }) {
  prev?.classList.remove("focused");
  cur?.classList.add("focused");

  if (lastSong != null) {
    songLastActiveIdx = lastSong.i() === -1 ? 0 : lastSong.i();
  }
  lastSong?.removeListeners(); // 移除这首歌曲和焦点有关的事件
  if (curI > -1) {
    lastSong = initSongBagel(curI, songLastActiveIdx); // 对这首歌的焦点进行管理
  }
}</code>
      </pre>
      </details>

      <!-- <h2>菜单</h2>

      <h2>复选框</h2> -->
    </main>
  </body>
</html>